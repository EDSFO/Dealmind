// dealmind/prisma/schema.prisma

// === DATA SOURCE ===
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// === GENERATOR ===
generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

// === ENUMS ===
enum UserRole {
  VENDEDOR
  LIDER
  ADMIN
}

// === MODELS ===

// Tenant: Root entity for multi-tenancy
// Each tenant represents an isolated company environment
model Tenant {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now()) @map("created_at")

  // Relationships
  companies Company[]
  users     User[]
  invites   Invite[]

  @@map("tenants")
}

// Company: Organization belonging to a tenant
// One tenant can have multiple companies (optional for future expansion)
model Company {
  id        String   @id @default(uuid())
  tenantId  String   @map("tenant_id")
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relationships
  tenant Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users  User[]

  @@index([tenantId])
  @@map("companies")
}

// User: Individual user account linked to tenant and company
// User.id matches Supabase Auth users.id
model User {
  id        String   @id @default(uuid())
  tenantId  String   @map("tenant_id")
  companyId String?  @map("company_id")
  email     String
  name      String
  role      UserRole @default(VENDEDOR)
  deletedAt DateTime? @map("deleted_at")

  // Relationships
  tenant  Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  company Company? @relation(fields: [companyId], references: [id], onDelete: SetNull)

  // Constraints
  @@unique([tenantId, email])
  @@index([tenantId])
  @@index([companyId])
  @@map("users")
}

// Invite: User invitation tokens
model Invite {
  id          String   @id @default(uuid())
  email       String
  role        UserRole
  tenantId    String   @map("tenant_id")
  token       String   @unique
  expiresAt   DateTime @map("expires_at")
  usedAt      DateTime? @map("used_at")
  createdAt   DateTime @default(now()) @map("created_at")
  createdById String   @map("created_by_id")

  // Relationships
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([token])
  @@map("invites")
}
